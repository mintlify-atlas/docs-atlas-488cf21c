---
title: Filetype-specific plugins
description: Create plugins that work only for specific file types
---

Filetype plugins allow you to define settings, mappings, and commands that only apply to specific file types. They're loaded automatically when you open a file of that type.

## What are filetype plugins?

A filetype plugin is like a global plugin, except it sets options and defines mappings for the current buffer only. For example, you might want special settings for Python files that don't apply to JavaScript files.

## Creating a filetype plugin

<Steps>
  <Step title="Create the file in ftplugin/">
    Name your file after the filetype:

    ```
    ftplugin/python.vim      # For Python files
    ftplugin/javascript.vim  # For JavaScript files
    ftplugin/markdown.vim    # For Markdown files
    ```

    For multiple plugins for the same filetype:

    ```
    ftplugin/python_extra.vim
    ftplugin/python/custom.vim
    ```
  </Step>

  <Step title="Add a buffer guard">
    Prevent the plugin from loading twice for the same buffer:

    ```vim
    vim9script

    # Only do this when not done yet for this buffer
    if exists("b:did_ftplugin")
      finish
    endif
    b:did_ftplugin = 1
    ```

    Note that we use `b:did_ftplugin` (buffer variable), not `g:loaded_pluginname`.
  </Step>

  <Step title="Set buffer-local options">
    Use `setlocal` to affect only the current buffer:

    ```vim
    setlocal expandtab
    setlocal shiftwidth=4
    setlocal softtabstop=4
    setlocal textwidth=79
    ```

    Never use `:set` in filetype plugins - it would affect all buffers.
  </Step>

  <Step title="Create buffer-local mappings">
    Use `<buffer>` to make mappings work only in the current buffer:

    ```vim
    if !hasmapto('<Plug>JavaImport;')
      map <buffer> <unique> <LocalLeader>i <Plug>JavaImport;
    endif
    noremap <buffer> <unique> <Plug>JavaImport; oimport ""<Left><Esc>
    ```

    Use `<LocalLeader>` instead of `<Leader>` for filetype-specific mappings.
  </Step>

  <Step title="Add buffer-local commands">
    Create commands that only exist for this buffer:

    ```vim
    command -buffer Make make %:r.s
    ```
  </Step>

  <Step title="Set up undo actions">
    Always provide a way to undo your changes:

    ```vim
    b:undo_ftplugin = "setlocal fo< com< tw< commentstring<"
      \ .. "| unlet b:match_ignorecase b:match_words b:match_skip"
    ```

    This ensures settings are reset when the filetype changes.
  </Step>
</Steps>

## Complete example: Python filetype plugin

```vim
vim9script

# Only do this when not done yet for this buffer
if exists("b:did_ftplugin")
  finish
endif
b:did_ftplugin = 1

# Set Python-specific options
setlocal expandtab
setlocal shiftwidth=4
setlocal softtabstop=4
setlocal textwidth=79
setlocal commentstring=#\ %s
setlocal define=^\s*\(def\\|class\)

# Add to existing formatoptions
setlocal formatoptions-=t formatoptions+=croql

# Buffer-local mappings
if !exists("g:no_plugin_maps") && !exists("g:no_python_maps")
  if !hasmapto('<Plug>PythonImport;')
    map <buffer> <LocalLeader>i <Plug>PythonImport;
  endif
  noremap <buffer> <Plug>PythonImport; oimport <Esc>
endif

# Buffer-local command
command -buffer PythonRun !python3 %

# Undo changes when switching filetype
b:undo_ftplugin = "setlocal et< sw< sts< tw< cms< def< fo<"
  \ .. "| unlet b:did_ftplugin"
```

## Using setlocal effectively

Always use `setlocal` for buffer-local options:

```vim
# Good - affects only current buffer
setlocal textwidth=70

# Bad - affects all buffers
set textwidth=70
```

For options with multiple values, consider preserving user settings:

```vim
# Reset to default, then modify
setlocal formatoptions& formatoptions+=ro

# Or add/remove specific flags
setlocal formatoptions+=ro
setlocal formatoptions-=t
```

## Filetype plugin mappings

Use the two-step mapping approach with `<Plug>` and `<LocalLeader>`:

```vim
if !hasmapto('<Plug>JavaImport;')
  map <buffer> <unique> <LocalLeader>i <Plug>JavaImport;
endif
noremap <buffer> <unique> <Plug>JavaImport; oimport ""<Left><Esc>
```

Users can customize by setting `maplocalleader`:

```vim
# In .vimrc
g:maplocalleader = ","
```

Or by creating their own mapping:

```vim
# User's custom mapping
map ,i <Plug>JavaImport;
```

## Disabling filetype plugin mappings

Allow users to disable your mappings:

```vim
# Add mappings, unless the user didn't want this
if !exists("g:no_plugin_maps") && !exists("g:no_mail_maps")
  if !hasmapto('<Plug>MailQuote;')
    vmap <buffer> <LocalLeader>q <Plug>MailQuote;
    nmap <buffer> <LocalLeader>q <Plug>MailQuote;
  endif
  vnoremap <buffer> <Plug>MailQuote; :s/^/> /<CR>
  nnoremap <buffer> <Plug>MailQuote; :.,$s/^/> /<CR>
endif
```

Users can disable with:

```vim
g:no_plugin_maps = 1      # Disable all plugin mappings
g:no_mail_maps = 1        # Disable only mail plugin mappings
```

## Buffer-local variables

Use buffer variables (`b:var`) for buffer-specific data:

```vim
b:current_indent = 0
b:python_version = 3
b:comment_leader = '#'
```

Script variables are shared between all buffers:

```vim
var call_count = 0  # Shared across all buffers
```

## Defining functions efficiently

Define functions only once, even though the filetype plugin runs for each buffer:

```vim
if !exists("*FormatPython")
  def FormatPython()
    # Format Python code
  enddef
endif
```

Remember to use `vim9script noclear` at the top of your file to prevent functions from being deleted on reload.

## Undo settings properly

Always set `b:undo_ftplugin` to undo your changes:

```vim
# Basic undo
b:undo_ftplugin = "setlocal fo< com< tw<"

# Undo multiple things
b:undo_ftplugin = "setlocal fo< com< tw< commentstring<"
  \ .. "| unlet b:match_words b:match_skip"
  \ .. "| execute 'au! BufEnter <buffer>'"
```

Using `<` after an option name resets it to the global value.

## Filetype detection

If your filetype isn't detected automatically, create a detection file:

```vim
" ftdetect/myfiletype.vim
au BufNewFile,BufRead *.myext setlocal filetype=myfiletype
```

For more complex detection:

```vim
" ftdetect/config.vim
au BufNewFile,BufRead *
  \ if getline(1) =~ '^# Config file' |
  \   setlocal filetype=myconfig |
  \ endif
```

## Overriding default filetype plugins

Users can override default settings by creating their own filetype plugin:

```vim
" ~/.vim/ftplugin/python.vim
vim9script

# This loads BEFORE the default plugin
b:did_ftplugin = 1

# Now add your own settings
setlocal textwidth=100
```

Or users can override specific settings using the `after` directory:

```vim
" ~/.vim/after/ftplugin/python.vim
setlocal textwidth=100
```

Files in `after/` are sourced after the default plugin.

## Example: Markdown filetype plugin

```vim
vim9script

if exists("b:did_ftplugin")
  finish
endif
b:did_ftplugin = 1

# Text formatting for prose
setlocal textwidth=80
setlocal formatoptions+=t
setlocal formatoptions-=l
setlocal wrap
setlocal linebreak

# Comments in markdown (for vim-commentary, etc.)
setlocal commentstring=<!--\ %s\ -->

# Spell checking
setlocal spell
setlocal spelllang=en_us

# Bold and italic text objects
if !exists("g:no_markdown_maps")
  # Bold word
  nnoremap <buffer> <LocalLeader>b viw<Esc>a**<Esc>bi**<Esc>
  # Italic word
  nnoremap <buffer> <LocalLeader>i viw<Esc>a*<Esc>bi*<Esc>
endif

b:undo_ftplugin = "setlocal tw< fo< wrap< lbr< spell< spl< cms<"
```

## Best practices

- Always use `setlocal`, never `set`
- Use `<buffer>` for all mappings
- Use `<LocalLeader>` for mapping prefixes
- Always provide `b:undo_ftplugin`
- Check for `b:did_ftplugin` at the start
- Allow users to disable mappings with `g:no_plugin_maps`
- Use `b:` variables for buffer-specific data
- Define functions only once with `if !exists("*Function")`

## Summary of special items

| Item | Purpose |
|------|----------|
| `<LocalLeader>` | Prefix for filetype plugin mappings (user-configurable) |
| `map <buffer>` | Define mapping local to current buffer |
| `noremap <script>` | Only remap script-local mappings starting with `<SID>` |
| `setlocal` | Set option for current buffer only |
| `command -buffer` | Define command local to current buffer |
| `exists("*Func")` | Check if function already defined |
| `b:did_ftplugin` | Guard variable for filetype plugins |
| `b:undo_ftplugin` | Commands to undo filetype plugin changes |

## Next steps

- [Creating your first plugin](/plugins/creating-plugins)
- [Plugin file structure](/plugins/plugin-structure)
- [Plugin development best practices](/plugins/best-practices)